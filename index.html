<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sim World</title>
<style>
body{margin:0;background:#000;overflow:hidden}
canvas{display:block;margin:auto;background:#111}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=800;
canvas.height=600;

const W=800,H=600;

function rand(a,b){return Math.random()*(b-a)+a}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

let time=0;

// ===== WORLD OBJECTS =====
let trees=[],rocks=[],foods=[];

for(let i=0;i<40;i++)
 trees.push({x:rand(0,W),y:rand(0,H),hp:3});

for(let i=0;i<35;i++)
 rocks.push({x:rand(0,W),y:rand(0,H),hp:4});

for(let i=0;i<50;i++)
 foods.push({x:rand(0,W),y:rand(0,H)});

// ===== AGENTS =====
let agents=[];
for(let i=0;i<12;i++){
 agents.push({
  x:rand(0,W),
  y:rand(0,H),
  hunger:100,
  wood:0,
  stone:0,
  target:null
 });
}

// ===== AI =====
function findNearest(list,a){
 let best=null,d=9999;
 for(let o of list){
  let dd=dist(a,o);
  if(dd<d){d=dd;best=o;}
 }
 return best;
}

function updateAgent(a){

 a.hunger-=0.02;

 // choose target
 if(!a.target || Math.random()<0.01){
  if(a.hunger<60 && foods.length)
   a.target=findNearest(foods,a);
  else if(a.wood<5 && trees.length)
   a.target=findNearest(trees,a);
  else if(rocks.length)
   a.target=findNearest(rocks,a);
 }

 if(!a.target) return;

 // move
 let dx=a.target.x-a.x;
 let dy=a.target.y-a.y;
 let d=Math.hypot(dx,dy);

 if(d>2){
  a.x+=dx/d*0.6;
  a.y+=dy/d*0.6;
 }else{

  // interact
  if(foods.includes(a.target)){
   a.hunger=100;
   foods.splice(foods.indexOf(a.target),1);
  }

  else if(trees.includes(a.target)){
   a.target.hp--;
   if(a.target.hp<=0){
    a.wood++;
    trees.splice(trees.indexOf(a.target),1);
   }
  }

  else if(rocks.includes(a.target)){
   a.target.hp--;
   if(a.target.hp<=0){
    a.stone++;
    rocks.splice(rocks.indexOf(a.target),1);
   }
  }

  a.target=null;
 }
}

// ===== DRAW =====
function draw(){

 ctx.clearRect(0,0,W,H);

 // day night
 let daylight=(Math.sin(time*0.002)+1)/2;
 ctx.fillStyle=`rgba(0,0,0,${1-daylight})`;
 ctx.fillRect(0,0,W,H);

 // trees
 ctx.fillStyle="green";
 for(let t of trees)
  ctx.fillRect(t.x,t.y,10,10);

 // rocks
 ctx.fillStyle="gray";
 for(let r of rocks)
  ctx.fillRect(r.x,r.y,9,9);

 // food
 ctx.fillStyle="yellow";
 for(let f of foods)
  ctx.fillRect(f.x,f.y,6,6);

 // agents
 for(let a of agents){

  // body
  ctx.fillStyle="lime";
  ctx.fillRect(a.x-4,a.y-4,8,8);

  // hunger bar
  ctx.fillStyle="red";
  ctx.fillRect(a.x-5,a.y-9,10,2);
  ctx.fillStyle="lime";
  ctx.fillRect(a.x-5,a.y-9,10*(a.hunger/100),2);

  // inventory text
  ctx.fillStyle="white";
  ctx.font="8px monospace";
  ctx.fillText(a.wood+"|"+a.stone,a.x-7,a.y+14);
 }
}

// ===== LOOP =====
function loop(){
 time++;
 for(let a of agents) updateAgent(a);
 draw();
 requestAnimationFrame(loop);
}
loop();

// ===== RESOURCE RESPAWN =====
setInterval(()=>{
 if(foods.length<60)
  foods.push({x:rand(0,W),y:rand(0,H)});
 if(trees.length<45)
  trees.push({x:rand(0,W),y:rand(0,H),hp:3});
 if(rocks.length<40)
  rocks.push({x:rand(0,W),y:rand(0,H),hp:4});
},3000);

</script>
</body>
</html>
